(self.webpackChunkgauge_chart_plugin=self.webpackChunkgauge_chart_plugin||[]).push([[3422],{73422:function(e,t,n){n.r(t),n.d(t,{CoreGeoChart:function(){return W},GeoPushpinChart:function(){return K},MapboxTokenProvider:function(){return j},enrichMapboxToken:function(){return N},getColorMappingPredicate:function(){return g.NK},getGeoChartDimensions:function(){return _},useMapboxToken:function(){return G},useMapboxTokenStrict:function(){return F},withMapboxToken:function(){return z}});var o=n(5549),r=n(29732),i=n(8297),s=n(51485),a=n(65613),l=n(25972),c=n(24544),u=n(47591),g=n(16576),d=n(35967),p=n(80961),m=n(34910);class h extends d.eH{createColorAssignment(e,t,n,o,r){return o?{fullColorAssignment:this.getColorStrategyForSegmentBy(e,t,o,r)}:{fullColorAssignment:[this.getColorStrategyForLocation(e,t,n,r)]}}getColorStrategyForSegmentBy(e,t,n,o){return new p.l(e,t,null,n,o).getColorAssignment()}getColorStrategyForLocation(e,t,n,o){const r=(0,g.gG)(n,t,o);return{headerItem:n,color:void 0!==r&&(0,d.HY)(r,e)?r:{type:"guid",value:e[0].guid}}}}var f=n(4270),C=n(94184),x=n(25356),b=n(111),k=n(88699),w=n(65846),L=n(40207),I=n(17096),T=n(90297),y=n(62269),O=n(50038),P=n(91964);const v=(0,c.lazy)((()=>Promise.all([n.e(4585),n.e(257)]).then(n.bind(n,1339)))),E=(0,x.b)(k.Z);function B(e){return(0,o.jsx)(c.Suspense,{fallback:null,children:(0,o.jsx)(v,{...e})})}function D(e){return(0,o.jsx)(a.IntlWrapper,{locale:e.locale,children:(0,o.jsx)(a.IntlTranslationsProvider,{children:t=>(0,o.jsx)(y.Z,{...e,numericSymbols:t.numericSymbols})})})}const S={mapboxToken:""};class R extends c.PureComponent{static getDerivedStateFromProps(e,t){const{geoChartOptions:n}=e;if(!n)return null;const{categoryItems:o,colorStrategy:r}=n,i=r.getColorAssignment();return(0,O.aL)(t.colorAssignmentItem,i)?{enabledLegendItems:new Array(o.length).fill(!0),colorAssignmentItem:i}:null}throttledOnWindowResize;containerId=`geo-${(0,w.Z)()}`;constructor(e){super(e);const{documentObj:t=document}=this.props;this.state={enabledLegendItems:[],showFluidLegend:(0,L.nf)(t),colorAssignmentItem:[]},this.throttledOnWindowResize=(0,b.Z)(this.onWindowResize,100)}componentDidMount(){this.updateConfigurationPanel(this.props.geoChartOptions),window.addEventListener("resize",this.throttledOnWindowResize)}componentDidUpdate(){this.updateConfigurationPanel(this.props.geoChartOptions)}componentWillUnmount(){this.throttledOnWindowResize.cancel(),window.removeEventListener("resize",this.throttledOnWindowResize)}render(){const{height:e,config:t}=this.props;return void 0===e||(0,P.fO)(t?.legend?.responsive)?(0,o.jsx)(E,{client:!0,children:({measureRef:e,contentRect:t})=>{const{client:n}=t;return this.renderVisualizationContent(e,n?.height??0,t)}}):this.renderVisualizationContent(void 0,e)}renderVisualizationContent(e,t,n){const{geoChartOptions:r}=this.props,i=this.syncWithLegendItemStates(r),s=this.getLegendDetails(this.getLegendPosition(),n),a=s?s.position:I.tV.TOP,l=this.getContainerClassName(a),c=a===I.tV.TOP||a===I.tV.LEFT&&(!this.state.showFluidLegend||!!this.props.config?.respectLegendPosition),u=this.renderLegend(t,a,i,n);return(0,o.jsxs)("div",{className:l,ref:e,children:[c?u:null,this.renderChart(i),c?null:u]})}syncWithLegendItemStates(e){(0,u.kG)(e,"illegal state - trying to sync legend with no geo options");const{categoryItems:t}=e,{enabledLegendItems:n}=this.state,o=t.map(((e,t)=>({...e,isVisible:n[t]})));return{...e,categoryItems:o}}getContainerClassName(e){const t=!0===(0,P.o2)(this.props?.config?.legend?.responsive),n=this.getFlexDirection(e);return C("viz-line-family-chart-wrap","gd-geo-component","s-gd-geo-component",{"responsive-legend":t,"non-responsive-legend":!t,[`flex-direction-${n}`]:!0,"legend-position-bottom":e===I.tV.BOTTOM},this.containerId)}getFlexDirection(e){const t=this.isFluidLegend();return e===I.tV.TOP||e===I.tV.BOTTOM||t?"column":"row"}isFluidLegend(){const{showFluidLegend:e}=this.state,t=(0,P.o2)(this.props?.config?.legend?.responsive);return!(0,P.fO)(t)&&(0,O.eC)(t,e)}onLegendItemClick=e=>{const t=this.state.enabledLegendItems.map(((t,n)=>n===e.legendIndex?!t:t));this.setState({enabledLegendItems:t})};getLegendPosition(){const e=this.props.config?.legend?.position??I.tV.TOP;return I.nB.indexOf(e)>-1?e:I.tV.TOP}getLegendDetails(e,t){const{geoChartOptions:n,config:o}=this.props,r=this.syncWithLegendItemStates(n),{geoData:i}=r,s=i?.segment?.name,a={showFluidLegend:this.isFluidLegend(),contentRect:t,legendLabel:s};return(0,T.$)(e,(0,P.o2)(o?.legend?.responsive),a,o?.respectLegendPosition)}getLegendProps(e,t,n,o){const r=this.props.config?.legend?.responsive,{locale:i}=this.props,{enabledLegendItems:s}=this.state,a=this.isFluidLegend(),{geoData:l,colorStrategy:c,categoryItems:u}=n,{segment:g}=l,d=l.color?.format,p=l.size?.format,m={format:d||p,geoData:l},h=c.getColorByIndex(0),f=this.getLegendDetails(t,o);let C={height:e,locale:i,position:t,responsive:r,isFluidLegend:a,onItemClick:this.onLegendItemClick,contentRect:o,containerId:this.containerId};return f&&(C={...C,maxRows:f.maxRows,name:f.name,renderPopUp:f.renderPopUp}),g&&s.length?{...C,...m,categoryItems:u,colorLegendValue:h}:{...C,...m,colorLegendValue:h}}getChartProps(e){const{config:t=S,dataView:n,drillableItems:o=[],afterRender:r=(()=>{}),onCenterPositionChanged:i=(()=>{}),onDrill:s=(()=>{}),onZoomChanged:l=(()=>{}),intl:c,onError:g}=this.props;(0,u.kG)(n,"invalid state - trying to render geo chart but there is no data to visualize");const{geoData:d,colorStrategy:p,categoryItems:m}=e,h=e.geoData.segment?.index,f={colorStrategy:p,config:t,dataView:n,drillableItems:(0,a.convertDrillableItemsToPredicates)(o),drillConfig:{dataView:n,onDrill:s},afterRender:r,geoData:d,onCenterPositionChanged:i,onZoomChanged:l,intl:c,...g?{onError:g}:{}};if(void 0!==h){const e=m.filter((e=>e.isVisible)).map((e=>e.uri));return{...f,config:{...t,selectedSegmentItems:e}}}return f}renderChart=e=>{const{chartRenderer:t=B}=this.props;return t(this.getChartProps(e))};renderLegend=(e,t,n,o)=>{const r=this.props.config?.legend?.enabled??!0,{legendRenderer:i=D}=this.props;return r?i(this.getLegendProps(e,t,n,o)):null};onWindowResize=()=>{const{documentObj:e=document}=this.props;this.setState({showFluidLegend:(0,L.nf)(e)})};updateConfigurationPanel(e){(0,u.kG)(e,"illegal state - updating config with no geo options");const{pushData:t}=this.props,{categoryItems:n,geoData:o,colorStrategy:r,colorPalette:i}=e,{hasCategoryLegend:s,hasColorLegend:a,hasSizeLegend:l}=(0,m.T6)(n,o),c=s||a||l;t?.({propertiesMeta:{legend_enabled:c},colors:{colorAssignments:r.getColorAssignment(),colorPalette:i}})}}var M=n(50576);const V=(0,c.createContext)({mapboxToken:void 0});function j({token:e,children:t}){return(0,o.jsx)(V.Provider,{value:{mapboxToken:e},children:t})}function z(e){return function(t){const{mapboxToken:n}=(0,c.useContext)(V);return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(e,{...t,config:N(t.config,n)})})}}function N(e,t){return t?{...e||{},mapboxToken:e?.mapboxToken||t}:e}function F(e){const t=(0,c.useContext)(V),n=e??t.mapboxToken;return(0,u.kG)(n,"Mapbox token was not provided. Use <MapboxTokenProvider /> to provide token."),n}function G(e){const t=(0,c.useContext)(V);return e??t.mapboxToken}const A=(0,l.Zz)(z(function(e){const t=(0,c.memo)((function(t){const[n,r]=(0,c.useState)(!1),i=(0,c.useRef)((0,a.newErrorMapping)(t.intl)),s=(0,c.useRef)(t.config?.mapboxToken),l=t.config?.mapboxToken??"",{execution:u}=t,g=!(0,O.B8)(u.definition.buckets),d=!l,p=(0,c.useCallback)((()=>{const{onError:e}=t;g&&e?.(new a.GeoLocationMissingSdkError),(n||d)&&e?.(new a.GeoTokenMissingSdkError)}),[g,n,d,t]),m=(0,c.useCallback)((()=>{r(!0)}),[]),h=(0,c.useCallback)((e=>{(0,a.isGeoTokenMissing)(e)?m():t.onError?.(e)}),[m,t]),f=(0,c.useCallback)((e=>{const n=t.ErrorComponent??a.ErrorComponent,r=i.current[e]||i.current[a.ErrorCodes.UNKNOWN_ERROR];return(0,o.jsx)(n,{code:e,...r})}),[t.ErrorComponent]);return(0,c.useEffect)((()=>{s.current!==t.config?.mapboxToken&&(r(!1),s.current=t.config?.mapboxToken),p()}),[p,t.config?.mapboxToken]),n||d?f(a.ErrorCodes.GEO_MAPBOX_TOKEN_MISSING):g?f(a.ErrorCodes.GEO_LOCATION_MISSING):(0,o.jsx)(e,{...t,onError:h})}),((e,t)=>{const{config:n,execution:o,drillableItems:r}=e,{config:i,execution:s,drillableItems:a}=t,l=((e,t)=>{const n=(e?.colorMapping||[]).map((e=>e.color)),o=(t?.colorMapping||[]).map((e=>e.color)),r={...e,colorMapping:n},i={...t,colorMapping:o};return(0,M.Z)(r,i)})(n,i),c=((e,t)=>e&&t?e.equals(t):e===t)(o,s),u=(0,M.Z)(r,a);return l&&c&&u}));return function(e){return(0,o.jsx)(a.IntlWrapper,{locale:e.locale,children:(0,o.jsx)(t,{...e})})}}((0,a.withEntireDataView)((function(e){const t=(0,c.useMemo)((()=>e.intl.formatMessage({id:"visualization.emptyValue"})),[e.intl]),n=(0,c.useMemo)((()=>e.intl.formatMessage({id:"visualization.emptyValue"})),[e.intl]),r=(0,c.useMemo)((()=>(0,a.newErrorMapping)(e.intl)),[e.intl]),l=(0,c.useCallback)(((e,t)=>{if(!t.dataView)return;const{dataView:n}=t,o=t.config?.limit??f.gc,r=a.DataViewFacade.for(n);return{isDataTooLarge:!(0,O.Ur)(r,e,o)}}),[]),d=(0,c.useCallback)((e=>function(e,t,n){return e.getColorAssignment().map(((o,r)=>{const{name:i,uri:l}=(0,s.isResultAttributeHeader)(o.headerItem)?o.headerItem.attributeHeaderItem:{name:t,uri:t},c=e.getColorByIndex(r);return{type:a.VisualizationTypes.PUSHPIN,uri:l??n,name:i??n,color:c,legendIndex:r,isVisible:!0}}))}(e,t,n)),[t,n]),p=(0,c.useCallback)(((e,t)=>{const{segment:n}=e,{config:{colors:o=[],colorPalette:r=[],colorMapping:s=[]}={},dataView:l}=t,c=a.DataViewFacade.for(l),u=(0,g.CW)(o,r),p=function(e,t,n,o){const{locationAttribute:r,segmentByAttribute:s}=(0,m.Dc)(o,n),a={attributeHeader:(0,i.Z)(r,"items")};return new h(e,t,a,s,o)}(u,s,e,c);return{geoData:e,categoryItems:n?d(p):[],colorStrategy:p,colorPalette:u}}),[d]),C=(0,c.useCallback)((()=>{const{dataView:r,onDataTooLarge:i}=e,s=a.DataViewFacade.for(r),c=(0,m.uR)(s,t,n),g=l(c,e);if(g?.isDataTooLarge){(0,u.kG)(i,"GeoChart's onDataTooLarge callback is missing.");const{location:t}=c,n=(0,O.xm)(s,c),o=void 0===t?[]:n[t.index];return i(void 0,`LocationData limit: ${e.config?.limit??f.gc} actual: ${o.length}`),null}const d=p(c,e);return(0,o.jsx)(R,{...e,geoChartOptions:d})}),[p,t,n,e,l]),{dataView:x,error:b,isLoading:k}=e,w=null===e.ErrorComponent?null:e.ErrorComponent??a.ErrorComponent,L=null===e.LoadingComponent?null:e.LoadingComponent??a.LoadingComponent;if(b){const e=r[Object.prototype.hasOwnProperty.call(r,b)?b:a.ErrorCodes.UNKNOWN_ERROR];return w?(0,o.jsx)(w,{code:b,...e}):null}return k||!x?L?(0,o.jsx)(L,{}):null:C()})))));function W(e){return(0,o.jsx)(l.ze,{theme:e.theme||{},themeIsLoading:!1,children:(0,o.jsx)(A,{...e})})}function Z(e){return void 0!==e.location}function _(e){const t=e.buckets,n=(0,s.bucketsMeasures)(t),o=(0,s.bucketsAttributes)(t);return(0,r.Z)([n.length>0&&(0,s.newDimension)([s.MeasureGroupIdentifier]),(0,s.newDimension)(o)])}const U=(0,l.Zz)((0,a.withContexts)((function(e){const{backend:t,workspace:n,sortBy:r,filters:l,exportTitle:c,execConfig:u={}}=e,g=(e=>{const{color:t,segmentBy:n,size:o,config:r}=e,i=[(0,s.newBucket)(a.BucketNames.SIZE,...o?[(0,s.disableComputeRatio)(o)]:[]),(0,s.newBucket)(a.BucketNames.COLOR,...t?[(0,s.disableComputeRatio)(t)]:[])];if(Z(e)){const{location:t}=e;i.push((0,s.newBucket)(a.BucketNames.LOCATION,...t?[t]:[]))}else{const{latitude:t,longitude:n}=e;i.push((0,s.newBucket)(a.BucketNames.LATITUDE,...t?[t]:[])),i.push((0,s.newBucket)(a.BucketNames.LONGITUDE,...n?[n]:[]))}i.push((0,s.newBucket)(a.BucketNames.SEGMENT,...n?[n]:[]));const l=r?.[a.BucketNames.TOOLTIP_TEXT];return l&&i.push((0,s.newBucket)(a.BucketNames.TOOLTIP_TEXT,l)),i})(e),d=(0,i.Z)(e,(e=>{const t=["backend","workspace","segmentBy","filters","sortBy","color","size"];return Z(e)?[...t,"location"]:[...t,"longitude","latitude"]})(e)),p=t.withTelemetry("GeoPushpinChart",e).workspace(n).execution().forBuckets(g,l).withSorting(...r||[]).withDimensions(_).withExecConfig(u);return(0,o.jsx)(a.IntlWrapper,{locale:e.locale,children:(0,o.jsx)(a.IntlTranslationsProvider,{children:t=>(0,o.jsx)(W,{intl:t.intl,execution:p,exportTitle:c||"GeoPushpinChart",enableExecutionCancelling:e.config?.enableExecutionCancelling??!1,...d})})})})));function H(e){const[t,n,r,i,s,l]=(0,a.useResolveValuesWithPlaceholders)([e.location,e.size,e.color,e.segmentBy,e.filters,e.sortBy],e.placeholdersResolutionContext);return(0,o.jsx)(U,{...e,location:t,size:n,color:r,segmentBy:i,filters:s,sortBy:l})}function $(e){const[t,n,r,i,s,l,c]=(0,a.useResolveValuesWithPlaceholders)([e.longitude,e.latitude,e.size,e.color,e.segmentBy,e.filters,e.sortBy],e.placeholdersResolutionContext);return(0,o.jsx)(U,{...e,longitude:t,latitude:n,size:r,color:i,segmentBy:s,filters:l,sortBy:c})}function K(e){return Z(e)?(0,o.jsx)(H,{...e}):(0,o.jsx)($,{...e})}},111:function(e,t,n){var o=n(99111),r=n(77226);t.Z=function(e,t,n){var i=!0,s=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return(0,r.Z)(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),(0,o.Z)(e,t,{leading:i,maxWait:t,trailing:s})}}}]);